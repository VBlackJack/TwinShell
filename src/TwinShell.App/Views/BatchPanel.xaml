<UserControl x:Class="TwinShell.App.Views.BatchPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="600" d:DesignWidth="900"
             Background="{StaticResource BackgroundBrush}">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
        </Grid.RowDefinitions>

        <!-- UX: Action Buttons with consistent spacing and sizing -->
        <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,16">
            <Button Content="Execute Batch"
                    Command="{Binding ExecuteBatchCommand}"
                    Style="{StaticResource PrimaryButtonStyle}"
                    Padding="16,10"
                    Margin="0,0,8,0"
                    MinWidth="44"
                    MinHeight="44"
                    TabIndex="1"
                    ToolTip="Execute the selected batch of commands"
                    AutomationProperties.Name="Execute batch"
                    AutomationProperties.HelpText="Execute all commands in the selected batch sequentially or in parallel"/>
            <Button Content="Import Batch"
                    Command="{Binding ImportBatchCommand}"
                    Padding="12,10"
                    Margin="0,0,8,0"
                    MinWidth="44"
                    MinHeight="44"
                    TabIndex="2"
                    Background="{StaticResource SurfaceBrush}"
                    Foreground="{StaticResource TextPrimaryBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    Cursor="Hand"
                    ToolTip="Import a batch from a JSON file"
                    AutomationProperties.Name="Import batch"
                    AutomationProperties.HelpText="Import a batch configuration from a JSON file">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HoverBackgroundBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Export Batch"
                    Command="{Binding ExportBatchCommand}"
                    Padding="12,10"
                    Margin="0,0,8,0"
                    MinWidth="44"
                    MinHeight="44"
                    TabIndex="3"
                    Background="{StaticResource SurfaceBrush}"
                    Foreground="{StaticResource TextPrimaryBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    Cursor="Hand"
                    ToolTip="Export the selected batch to a JSON file"
                    AutomationProperties.Name="Export batch"
                    AutomationProperties.HelpText="Export the selected batch configuration to a JSON file">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{StaticResource HoverBackgroundBrush}"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
            <Button Content="Delete Batch"
                    Command="{Binding DeleteBatchCommand}"
                    Padding="12,10"
                    MinWidth="44"
                    MinHeight="44"
                    TabIndex="4"
                    Background="{StaticResource DangerBrush}"
                    Foreground="White"
                    BorderThickness="0"
                    Cursor="Hand"
                    ToolTip="Delete the selected batch"
                    AutomationProperties.Name="Delete batch"
                    AutomationProperties.HelpText="Permanently delete the selected batch">
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Button.Template>
                <Button.Style>
                    <Style TargetType="Button">
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Opacity" Value="0.9"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </StackPanel>

        <!-- UX: Batch List with modern Border instead of GroupBox -->
        <Border Grid.Row="1"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Margin="0,0,0,16">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top"
                           Text="Available Batches"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Padding="12"
                           Background="{StaticResource PrimaryBrush}"
                           Foreground="White"/>

                <ListBox ItemsSource="{Binding Batches}"
                         SelectedItem="{Binding SelectedBatch}"
                         BorderThickness="0"
                         ScrollViewer.VerticalScrollBarVisibility="Auto"
                         TabIndex="5"
                         AutomationProperties.Name="Available batches"
                         AutomationProperties.HelpText="List of saved command batches. Select one to execute, edit, or delete.">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Border Background="White"
                                    BorderBrush="{StaticResource BorderBrush}"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Margin="8">
                                <StackPanel>
                                    <TextBlock Text="{Binding Name}"
                                               FontWeight="SemiBold"
                                               FontSize="14"
                                               Foreground="{StaticResource TextPrimaryBrush}"/>
                                    <TextBlock Text="{Binding Description}"
                                               FontSize="12"
                                               Foreground="{StaticResource TextSecondaryBrush}"
                                               Margin="0,4,0,0"
                                               TextWrapping="Wrap"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                                        <Border Style="{StaticResource PlatformBadgeStyle}">
                                            <TextBlock FontSize="10"
                                                       Foreground="{StaticResource PrimaryBrush}">
                                                <Run Text="{Binding CommandCount, Mode=OneWay}"/>
                                                <Run Text="commands"/>
                                            </TextBlock>
                                        </Border>
                                        <Border Style="{StaticResource LevelBadgeStyle}"
                                                Background="{StaticResource SuccessBrush}"
                                                Opacity="0.2"
                                                BorderBrush="{StaticResource SuccessBrush}">
                                            <TextBlock Text="{Binding ExecutionMode}"
                                                       FontSize="10"
                                                       Foreground="{StaticResource SuccessBrush}"
                                                       FontWeight="SemiBold"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- UX: Progress indicator with modern styling -->
        <Border Grid.Row="2"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16"
                Visibility="{Binding IsExecuting, Converter={StaticResource BooleanToVisibilityConverter}}"
                AutomationProperties.LiveSetting="Polite">
            <StackPanel>
                <TextBlock Text="Execution Progress"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Foreground="{StaticResource TextPrimaryBrush}"
                           Margin="0,0,0,8"/>
                <TextBlock Text="{Binding ProgressMessage}"
                           FontSize="12"
                           Foreground="{StaticResource TextSecondaryBrush}"
                           Margin="0,0,0,8"/>
                <ProgressBar Value="{Binding ProgressPercentage}"
                             Height="24"
                             Minimum="0"
                             Maximum="100"
                             Foreground="{StaticResource SuccessBrush}"
                             AutomationProperties.Name="Batch execution progress"
                             AutomationProperties.HelpText="{Binding ProgressMessage}"/>
            </StackPanel>
        </Border>

        <!-- UX: Output Console with modern styling -->
        <Border Grid.Row="3"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top"
                           Text="Command Output"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Padding="12"
                           Background="{StaticResource PrimaryBrush}"
                           Foreground="White"/>

                <ScrollViewer VerticalScrollBarVisibility="Auto"
                              Background="#1E1E1E"
                              Padding="8">
                    <ItemsControl ItemsSource="{Binding OutputLines}"
                                  AutomationProperties.Name="Command output"
                                  AutomationProperties.HelpText="Output from executed commands">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding Text}"
                                           Foreground="{Binding IsError, Converter={StaticResource ErrorToColorConverter}}"
                                           FontFamily="Consolas"
                                           FontSize="12"
                                           Margin="4,2"
                                           TextWrapping="Wrap"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
            </DockPanel>
        </Border>

        <!-- UX: Enhanced empty state with icon and better guidance -->
        <StackPanel Grid.Row="1"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Visibility="{Binding Batches.Count, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert}">
            <TextBlock Text="ðŸ“¦"
                       FontSize="64"
                       HorizontalAlignment="Center"
                       Margin="0,0,0,16"
                       Opacity="0.3"/>
            <TextBlock Text="No Batches Yet"
                       FontSize="18"
                       FontWeight="SemiBold"
                       HorizontalAlignment="Center"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       Margin="0,0,0,12"/>
            <TextBlock FontSize="12"
                       HorizontalAlignment="Center"
                       Foreground="{StaticResource TextSecondaryBrush}"
                       TextAlignment="Center"
                       MaxWidth="450"
                       TextWrapping="Wrap"
                       LineHeight="18">
                <Run Text="Batches allow you to execute multiple commands sequentially or in parallel."/>
                <LineBreak/>
                <LineBreak/>
                <Run Text="Create your first batch to automate complex workflows and save time."/>
            </TextBlock>
        </StackPanel>
    </Grid>
</UserControl>
