<Window x:Class="TwinShell.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:TwinShell.App"
        xmlns:vm="clr-namespace:TwinShell.App.ViewModels"
        mc:Ignorable="d"
        Title="TwinShell - PowerShell &amp; Bash Command Manager"
        Height="700" Width="1200"
        Background="{StaticResource BackgroundBrush}">

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="TwinShell"
                       FontSize="28"
                       FontWeight="Bold"
                       Foreground="{StaticResource PrimaryBrush}"/>
            <TextBlock Text="Gestionnaire de commandes PowerShell &amp; Bash pour administrateurs systÃ¨me"
                       FontSize="12"
                       Foreground="{StaticResource TextSecondaryBrush}"/>
        </StackPanel>

        <!-- Search and Filters -->
        <Border Grid.Row="1"
                Background="{StaticResource SurfaceBrush}"
                BorderBrush="{StaticResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="8"
                Padding="16"
                Margin="0,0,0,16">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Search Box -->
                <Grid Grid.Row="0" Margin="0,0,0,12">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBox Grid.Column="0"
                             Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                             Style="{StaticResource ModernTextBoxStyle}"
                             FontSize="14">
                        <TextBox.InputBindings>
                            <KeyBinding Key="K" Modifiers="Control"
                                      Command="{Binding DataContext.ClearFiltersCommand, RelativeSource={RelativeSource AncestorType=Window}}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" Margin="12,0,0,0">
                        <TextBlock Text="ðŸ” Recherche (Ctrl+K pour effacer)"
                                   VerticalAlignment="Center"
                                   Foreground="{StaticResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Grid>

                <!-- Filters -->
                <Grid Grid.Row="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Platform Filters -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" Margin="0,0,24,0">
                        <TextBlock Text="Plateforme:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"
                                   FontWeight="SemiBold"/>
                        <CheckBox Content="Windows" IsChecked="{Binding FilterWindows}" Margin="0,0,12,0"/>
                        <CheckBox Content="Linux" IsChecked="{Binding FilterLinux}" Margin="0,0,12,0"/>
                        <CheckBox Content="Both" IsChecked="{Binding FilterBoth}"/>
                    </StackPanel>

                    <!-- Level Filters -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <TextBlock Text="Niveau:"
                                   VerticalAlignment="Center"
                                   Margin="0,0,12,0"
                                   FontWeight="SemiBold"/>
                        <CheckBox Content="Info" IsChecked="{Binding FilterInfo}" Margin="0,0,12,0"/>
                        <CheckBox Content="Run" IsChecked="{Binding FilterRun}" Margin="0,0,12,0"/>
                        <CheckBox Content="Dangerous" IsChecked="{Binding FilterDangerous}"/>
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="16"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Categories TreeView -->
            <Border Grid.Column="0"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                <StackPanel>
                    <TextBlock Text="CatÃ©gories"
                               FontSize="14"
                               FontWeight="Bold"
                               Padding="12"
                               Background="{StaticResource PrimaryBrush}"
                               Foreground="White"/>
                    <ListBox ItemsSource="{Binding Categories}"
                             SelectedItem="{Binding SelectedCategory}"
                             BorderThickness="0"
                             Background="Transparent">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" Padding="4"/>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </StackPanel>
            </Border>

            <!-- Actions ListBox -->
            <Border Grid.Column="2"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top"
                               Text="{Binding FilteredActions.Count, StringFormat='Actions ({0})'}"
                               FontSize="14"
                               FontWeight="Bold"
                               Padding="12"
                               Background="{StaticResource PrimaryBrush}"
                               Foreground="White"/>
                    <ListBox ItemsSource="{Binding FilteredActions}"
                             SelectedItem="{Binding SelectedAction}"
                             BorderThickness="0"
                             ScrollViewer.VerticalScrollBarVisibility="Auto"
                             ItemContainerStyle="{StaticResource ActionListBoxItemStyle}">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel>
                                    <TextBlock Text="{Binding Title}"
                                               FontWeight="SemiBold"
                                               TextWrapping="Wrap"/>
                                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                        <Border Style="{StaticResource PlatformBadgeStyle}">
                                            <TextBlock Text="{Binding Platform, Converter={StaticResource PlatformToTextConverter}}"
                                                       FontSize="10"
                                                       Foreground="{StaticResource PrimaryBrush}"/>
                                        </Border>
                                        <Border Style="{StaticResource LevelBadgeStyle}"
                                                Background="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}"
                                                Opacity="0.2"
                                                BorderBrush="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}">
                                            <TextBlock Text="{Binding Level, Converter={StaticResource CriticalityToTextConverter}}"
                                                       FontSize="10"
                                                       Foreground="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}"/>
                                        </Border>
                                    </StackPanel>
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </DockPanel>
            </Border>

            <!-- Action Details and Command Generator -->
            <Border Grid.Column="4"
                    Background="{StaticResource SurfaceBrush}"
                    BorderBrush="{StaticResource BorderBrush}"
                    BorderThickness="1"
                    CornerRadius="8">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="16" DataContext="{Binding SelectedAction}">
                        <!-- Show message when no action selected -->
                        <TextBlock Text="SÃ©lectionnez une action pour voir les dÃ©tails"
                                   FontStyle="Italic"
                                   Foreground="{StaticResource TextSecondaryBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Margin="0,100,0,0">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Visible"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>

                        <!-- Action Details -->
                        <StackPanel>
                            <StackPanel.Style>
                                <Style TargetType="StackPanel">
                                    <Setter Property="Visibility" Value="Visible"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding}" Value="{x:Null}">
                                            <Setter Property="Visibility" Value="Collapsed"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </StackPanel.Style>

                            <!-- Title -->
                            <TextBlock Text="{Binding Title}"
                                       FontSize="20"
                                       FontWeight="Bold"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,8"/>

                            <!-- Badges -->
                            <StackPanel Orientation="Horizontal" Margin="0,0,0,16">
                                <Border Style="{StaticResource PlatformBadgeStyle}">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Platform, Converter={StaticResource PlatformToIconConverter}}"
                                                   Margin="0,0,4,0"/>
                                        <TextBlock Text="{Binding Platform, Converter={StaticResource PlatformToTextConverter}}"
                                                   Foreground="{StaticResource PrimaryBrush}"/>
                                    </StackPanel>
                                </Border>
                                <Border Style="{StaticResource LevelBadgeStyle}"
                                        Background="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}"
                                        Opacity="0.2"
                                        BorderBrush="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}">
                                    <TextBlock Text="{Binding Level, Converter={StaticResource CriticalityToTextConverter}}"
                                               Foreground="{Binding Level, Converter={StaticResource CriticalityToColorConverter}}"
                                               FontWeight="SemiBold"/>
                                </Border>
                            </StackPanel>

                            <!-- Danger Banner -->
                            <Border Style="{StaticResource DangerBannerStyle}">
                                <Border.Style>
                                    <Style TargetType="Border" BasedOn="{StaticResource DangerBannerStyle}">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Level}" Value="2">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âš ï¸" FontSize="16" Margin="0,0,8,0"/>
                                    <TextBlock Text="ATTENTION : Cette commande peut causer des modifications importantes du systÃ¨me"
                                               Foreground="#D32F2F"
                                               FontWeight="SemiBold"
                                               TextWrapping="Wrap"/>
                                </StackPanel>
                            </Border>

                            <!-- Description -->
                            <TextBlock Text="Description"
                                       FontWeight="Bold"
                                       Margin="0,0,0,4"/>
                            <TextBlock Text="{Binding Description}"
                                       TextWrapping="Wrap"
                                       Margin="0,0,0,16"/>

                            <!-- Examples -->
                            <TextBlock Text="Exemples"
                                       FontWeight="Bold"
                                       Margin="0,0,0,4"/>
                            <ItemsControl ItemsSource="{Binding Examples}" Margin="0,0,0,16">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#F5F5F5"
                                                Padding="8"
                                                Margin="0,0,0,8"
                                                CornerRadius="4">
                                            <StackPanel>
                                                <TextBlock Text="{Binding Command}"
                                                           FontFamily="Consolas"
                                                           FontSize="12"
                                                           TextWrapping="Wrap"/>
                                                <TextBlock Text="{Binding Description}"
                                                           FontSize="11"
                                                           Foreground="{StaticResource TextSecondaryBrush}"
                                                           TextWrapping="Wrap"
                                                           Margin="0,4,0,0"/>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>

                            <!-- Notes -->
                            <StackPanel>
                                <StackPanel.Style>
                                    <Style TargetType="StackPanel">
                                        <Setter Property="Visibility" Value="Collapsed"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Notes, Converter={StaticResource BoolToVisibilityConverter}}" Value="Visible">
                                                <Setter Property="Visibility" Value="Visible"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </StackPanel.Style>
                                <TextBlock Text="Notes"
                                           FontWeight="Bold"
                                           Margin="0,0,0,4"/>
                                <TextBlock Text="{Binding Notes}"
                                           TextWrapping="Wrap"
                                           Margin="0,0,0,16"/>
                            </StackPanel>

                            <!-- Command Generator -->
                            <Border Background="#E8F5E9"
                                    BorderBrush="#4CAF50"
                                    BorderThickness="1"
                                    CornerRadius="4"
                                    Padding="12"
                                    Margin="0,8,0,0">
                                <StackPanel DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=Window}}">
                                    <TextBlock Text="GÃ©nÃ©rateur de commande"
                                               FontWeight="Bold"
                                               Margin="0,0,0,8"/>

                                    <!-- Parameters -->
                                    <ItemsControl ItemsSource="{Binding CommandParameters}">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate>
                                                <StackPanel Margin="0,0,0,8">
                                                    <TextBlock>
                                                        <Run Text="{Binding Label, Mode=OneWay}"/>
                                                        <Run Text="*" Foreground="Red">
                                                            <Run.Style>
                                                                <Style TargetType="Run">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                    <Style.Triggers>
                                                                        <DataTrigger Binding="{Binding Required}" Value="True">
                                                                            <Setter Property="Visibility" Value="Visible"/>
                                                                        </DataTrigger>
                                                                    </Style.Triggers>
                                                                </Style>
                                                            </Run.Style>
                                                        </Run>
                                                    </TextBlock>
                                                    <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                                                             Style="{StaticResource ModernTextBoxStyle}"
                                                             Margin="0,4,0,0"/>
                                                    <TextBlock Text="{Binding Description}"
                                                               FontSize="10"
                                                               Foreground="{StaticResource TextSecondaryBrush}"
                                                               TextWrapping="Wrap"
                                                               Margin="0,2,0,0"/>
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                    </ItemsControl>

                                    <!-- Generated Command -->
                                    <TextBlock Text="Commande gÃ©nÃ©rÃ©e"
                                               FontWeight="Bold"
                                               Margin="0,8,0,4"/>
                                    <Border Background="White"
                                            BorderBrush="{StaticResource BorderBrush}"
                                            BorderThickness="1"
                                            CornerRadius="4"
                                            Padding="8">
                                        <TextBlock Text="{Binding GeneratedCommand}"
                                                   FontFamily="Consolas"
                                                   TextWrapping="Wrap"/>
                                    </Border>

                                    <!-- Copy Button -->
                                    <Button Content="ðŸ“‹ Copier dans le presse-papiers"
                                            Command="{Binding CopyCommandCommand}"
                                            Style="{StaticResource PrimaryButtonStyle}"
                                            HorizontalAlignment="Right"
                                            Margin="0,8,0,0"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>
    </Grid>
</Window>
