{
  "id": "bitlocker-ad-export-all-keys",
  "title": "Exporter toutes les cl√©s BitLocker du domaine",
  "description": "Exporte un rapport CSV de tous les ordinateurs du domaine avec leurs cl√©s de r√©cup√©ration BitLocker (admin domaine).",
  "category": "üîí Security & Encryption",
  "platform": 0,
  "level": 2,
  "tags": [
    "bitlocker",
    "ad",
    "export",
    "backup",
    "domain-admin"
  ],
  "windowsCommandTemplateId": "bitlocker-ad-export-all-keys-cmd",
  "windowsCommandTemplate": {
    "id": "bitlocker-ad-export-all-keys-cmd",
    "platform": 0,
    "name": "Get-ADComputer",
    "commandPattern": "$report = @(); Get-ADComputer -Filter * | ForEach-Object { $computer = $_; $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword,msFVE-RecoveryGuid,whenCreated -ErrorAction SilentlyContinue; foreach($key in $keys) { $report += [PSCustomObject]@{ Computer=$computer.Name; RecoveryPassword=$key.'msFVE-RecoveryPassword'; VolumeGUID=$key.'msFVE-RecoveryGuid'; DateCreated=$key.whenCreated } } }; $report | Export-Csv C:\\BitLocker-All-Keys-$(Get-Date -Format 'yyyyMMdd-HHmm').csv -NoTypeInformation; Write-Host \"Rapport export√©: C:\\BitLocker-All-Keys-$(Get-Date -Format 'yyyyMMdd-HHmm').csv\" -ForegroundColor Green",
    "parameters": []
  },
  "examples": [
    {
      "command": "$report = @(); Get-ADComputer -Filter * | ForEach-Object { $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $_.DistinguishedName -Properties msFVE-RecoveryPassword -ErrorAction SilentlyContinue; foreach($k in $keys) { $report += [PSCustomObject]@{Computer=$_.Name; Password=$k.'msFVE-RecoveryPassword'} } }; $report | Export-Csv C:\\BitLocker-Keys-Full.csv -NoTypeInformation",
      "description": "Exporte TOUTES les cl√©s BitLocker du domaine dans un CSV",
      "platform": 1
    },
    {
      "command": "Get-ADComputer -Filter * -SearchBase 'OU=Laptops,DC=contoso,DC=com' | ForEach-Object { $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $_.DistinguishedName -Properties msFVE-RecoveryPassword -ErrorAction SilentlyContinue; if($keys) { Write-Host \"$($_.Name): $($keys[0].'msFVE-RecoveryPassword')\" } }",
      "description": "Exporte les cl√©s BitLocker uniquement pour une OU (ex: Laptops)",
      "platform": 1
    },
    {
      "command": "$report = @(); Get-ADComputer -Filter * | ForEach-Object { $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $_.DistinguishedName -Properties msFVE-RecoveryPassword,whenCreated -ErrorAction SilentlyContinue; $report += [PSCustomObject]@{Computer=$_.Name; KeyCount=$keys.Count; LatestKey=($keys | Sort-Object whenCreated -Descending | Select-Object -First 1).'msFVE-RecoveryPassword'} }; $report | Where-Object {$_.KeyCount -gt 0}",
      "description": "Rapport avec nombre de cl√©s et derni√®re cl√© de r√©cup√©ration par ordinateur",
      "platform": 1
    },
    {
      "command": "$date = Get-Date -Format 'yyyyMMdd'; Get-ADComputer -Filter * | ForEach-Object { $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $_.DistinguishedName -Properties msFVE-RecoveryPassword -ErrorAction SilentlyContinue; foreach($k in $keys) { \"$($_.Name): $($k.'msFVE-RecoveryPassword')\" | Out-File \"C:\\BitLocker-Backup-$date.txt\" -Append } }",
      "description": "Sauvegarde toutes les cl√©s dans un fichier texte dat√©",
      "platform": 1
    },
    {
      "command": "$report = @(); Get-ADComputer -Filter * | Select-Object * -First 1",
      "description": "Affiche toutes les propri√©t√©s du premier objet retourn√©. Select-Object * √©largit l'affichage pour montrer toutes les colonnes. -First 1 limite au premier r√©sultat. Utilisez cette commande pour d√©couvrir les propri√©t√©s disponibles avant de filtrer.",
      "platform": 0
    },
    {
      "command": "$report = @(); Get-ADComputer -Filter * | Format-Table -AutoSize",
      "description": "Affiche les r√©sultats dans un tableau optimis√© pour la console. Format-Table -AutoSize ajuste automatiquement la largeur des colonnes pour un affichage lisible. Id√©al pour visualiser rapidement les donn√©es structur√©es.",
      "platform": 0
    },
    {
      "command": "$report = @(); Get-ADComputer -Filter * | Measure-Object",
      "description": "Compte le nombre total d'objets retourn√©s. Measure-Object retourne Count, Sum, Average, Min, Max selon les propri√©t√©s. Utile pour les statistiques rapides et la validation de r√©sultats.",
      "platform": 0
    }
  ],
  "notes": "‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ULTRA-SENSIBLE: Ce rapport contient TOUTES les cl√©s BitLocker du domaine! STOCKAGE OBLIGATOIRE: Coffre-fort physique, Azure Key Vault, gestionnaire de mots de passe enterprise avec chiffrement hardware. NE JAMAIS: envoyer par email, stocker sur disque non chiffr√©, partager par Teams/Slack. ACC√àS: Limiter aux admins s√©curit√© senior uniquement. AUDIT: Logger qui g√©n√®re ce rapport. DESTRUCTION: Supprimer apr√®s sauvegarde s√©curis√©e.",
  "links": [
    {
      "title": "BitLocker Key Management Best Practices",
      "url": "https://learn.microsoft.com/en-us/windows/security/operating-system-security/data-protection/bitlocker/operations-guide"
    }
  ]
}