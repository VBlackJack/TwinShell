{
  "id": "wsus-configure-client",
  "title": "Configurer le client WSUS via le registre",
  "description": "Configure les param√®tres du client WSUS en modifiant les cl√©s de registre appropri√©es",
  "category": "üîÑ Windows Updates",
  "platform": 0,
  "level": 2,
  "tags": [
    "wsus",
    "client",
    "configuration",
    "registry"
  ],
  "windowsCommandTemplateId": "wsus-configure-client-cmd",
  "windowsCommandTemplate": {
    "id": "wsus-configure-client-cmd",
    "platform": 0,
    "name": "Set-ItemProperty",
    "commandPattern": "$WSUSServer = '{wsusServer}'; $WSUSPort = {wsusPort}; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv",
    "parameters": [
      {
        "name": "wsusServer",
        "label": "Serveur WSUS",
        "type": "string",
        "defaultValue": "wsus.domain.local",
        "required": true,
        "description": "Nom d'h√¥te ou IP du serveur WSUS"
      },
      {
        "name": "wsusPort",
        "label": "Port WSUS",
        "type": "number",
        "defaultValue": "8530",
        "required": true,
        "description": "Port du serveur WSUS (8530 HTTP ou 8531 HTTPS)"
      }
    ]
  },
  "examples": [
    {
      "command": "Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value 'http://wsus.domain.local:8530'",
      "description": "Configure l'adresse du serveur WSUS",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.contoso.com'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv -WhatIf",
      "description": "Simulation de l'action sans ex√©cution r√©elle (dry-run). Le switch -WhatIf affiche ce qui serait modifi√© sans appliquer les changements. INDISPENSABLE avant toute action de masse ou modification critique. Retirez -WhatIf apr√®s validation pour ex√©cuter.",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.contoso.com'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv -Confirm:$false",
      "description": "Ex√©cute l'action sans demander de confirmation interactive. -Confirm:$false supprime les invites de validation. Utile dans les scripts automatis√©s mais √† utiliser avec pr√©caution : aucun filet de s√©curit√©.",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.contoso.com'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv -PassThru",
      "description": "Force la commande √† retourner l'objet modifi√©/cr√©√© dans le pipeline. Par d√©faut, les cmdlets Set-/New- ne retournent rien. -PassThru active le retour pour permettre des op√©rations en cha√Æne ou des v√©rifications imm√©diates.",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.contoso.com'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv -Verbose",
      "description": "Affiche des informations d√©taill√©es sur l'ex√©cution de la commande. -Verbose active les messages de d√©bogage pour comprendre pr√©cis√©ment ce qui se passe. Essentiel pour le troubleshooting et la compr√©hension des op√©rations internes.",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.domain.local'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv",
      "description": "Exemple utilisant le param√®tre 'wsusServer': Nom d'h√¥te ou IP du serveur WSUS. Remplacez wsus.contoso.com par la valeur appropri√©e selon votre environnement.",
      "platform": 0
    },
    {
      "command": "$WSUSServer = 'wsus.contoso.com'; $WSUSPort = 8530; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate' -Name 'WUStatusServer' -Value \"http://$WSUSServer`:$WSUSPort\" -Type String -Force; Set-ItemProperty -Path 'HKLM:\\Software\\Policies\\Microsoft\\Windows\\WindowsUpdate\\AU' -Name 'UseWUServer' -Value 1 -Type DWord -Force; Restart-Service wuauserv",
      "description": "Exemple utilisant le param√®tre 'wsusPort': Port du serveur WSUS (8530 HTTP ou 8531 HTTPS). Remplacez 8530 par la valeur appropri√©e selon votre environnement.",
      "platform": 0
    }
  ],
  "notes": "ATTENTION: Modifie le registre. Port 8530=HTTP, 8531=HTTPS. N√©cessite red√©marrage du service wuauserv. √Ä utiliser pour machines hors domaine.",
  "links": [
    {
      "title": "Configure WSUS Client",
      "url": "https://blog.wapnet.nl/2022/05/configure-wsus-client-with-powershell-and-regedit/"
    }
  ]
}