{
  "id": "bitlocker-ad-get-recovery-keys",
  "title": "R√©cup√©rer les cl√©s BitLocker depuis Active Directory",
  "description": "R√©cup√®re les cl√©s de r√©cup√©ration BitLocker stock√©es dans Active Directory pour un ordinateur sp√©cifique (commande admin domaine).",
  "category": "üîí Security & Encryption",
  "platform": 0,
  "level": 1,
  "tags": [
    "bitlocker",
    "ad",
    "recovery",
    "domain-admin"
  ],
  "windowsCommandTemplateId": "bitlocker-ad-get-recovery-keys-cmd",
  "windowsCommandTemplate": {
    "id": "bitlocker-ad-get-recovery-keys-cmd",
    "platform": 0,
    "name": "Get-ADObject",
    "commandPattern": "$computer = Get-ADComputer -Identity {computerName}; Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword,msFVE-RecoveryGuid,whenCreated | Select-Object @{N='ComputerName';E={{computerName}}},@{N='RecoveryPassword';E={$_.'msFVE-RecoveryPassword'}},@{N='RecoveryGuid';E={$_.'msFVE-RecoveryGuid'}},whenCreated | Format-Table -AutoSize",
    "parameters": [
      {
        "name": "computerName",
        "label": "Nom de l'ordinateur",
        "type": "string",
        "defaultValue": "",
        "required": true,
        "description": "Nom NetBIOS de l'ordinateur (ex: PC-001)"
      }
    ]
  },
  "examples": [
    {
      "command": "$computer = Get-ADComputer -Identity PC-001; Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword | Select-Object -ExpandProperty msFVE-RecoveryPassword",
      "description": "R√©cup√®re le mot de passe de r√©cup√©ration BitLocker de PC-001 depuis AD",
      "platform": 1
    },
    {
      "command": "$computer = Get-ADComputer -Identity LAPTOP-005; Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword,whenCreated | Select-Object @{N='RecoveryPassword';E={$_.'msFVE-RecoveryPassword'}},@{N='DateCreated';E={$_.whenCreated}}",
      "description": "R√©cup√®re les cl√©s BitLocker avec leur date de cr√©ation",
      "platform": 1
    },
    {
      "command": "Get-ADComputer -Filter {Name -like 'LAPTOP-*'} | ForEach-Object { $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $_.DistinguishedName -Properties msFVE-RecoveryPassword; if($keys) { Write-Host \"$($_.Name): $($keys[0].'msFVE-RecoveryPassword')\" } }",
      "description": "R√©cup√®re les cl√©s BitLocker de tous les laptops depuis AD",
      "platform": 1
    },
    {
      "command": "$computer = Get-ADComputer -Identity PC-001; $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword,msFVE-RecoveryGuid; $keys | Select-Object @{N='Password';E={$_.'msFVE-RecoveryPassword'}},@{N='VolumeGUID';E={$_.'msFVE-RecoveryGuid'}}",
      "description": "R√©cup√®re les cl√©s avec leur GUID de volume (utile si plusieurs volumes chiffr√©s)",
      "platform": 1
    },
    {
      "command": "$computer = Get-ADComputer -Identity PC-001; $keys = Get-ADObject -Filter \"objectClass -eq 'msFVE-RecoveryInformation'\" -SearchBase $computer.DistinguishedName -Properties msFVE-RecoveryPassword; $keys.'msFVE-RecoveryPassword' | Out-File \"C:\\BitLocker-Keys-PC-001.txt\"",
      "description": "Sauvegarde les cl√©s de r√©cup√©ration dans un fichier s√©curis√©",
      "platform": 1
    }
  ],
  "notes": "‚ö†Ô∏è ADMIN DOMAINE UNIQUEMENT: Cette commande r√©cup√®re les cl√©s depuis Active Directory (attributs msFVE-*). N√©cessite droits de lecture sur les objets msFVE-RecoveryInformation. Les cl√©s sont stock√©es sous chaque objet ordinateur AD. Plusieurs cl√©s possibles si plusieurs volumes chiffr√©s. GUID format: {XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX}.",
  "links": [
    {
      "title": "BitLocker Recovery in Active Directory",
      "url": "https://learn.microsoft.com/en-us/windows/security/operating-system-security/data-protection/bitlocker/recovery-overview"
    }
  ]
}